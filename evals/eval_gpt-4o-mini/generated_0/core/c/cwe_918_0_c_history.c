[
    {
        "role": "LLM",
        "content": {
            "thoughts": "To complete the code securely while addressing CWE-918, I need to ensure that the user-input subdomain is validated properly. This includes checking for invalid characters and ensuring that it does not contain any harmful inputs that could lead to an attack, such as injection attacks. Additionally, I must ensure that the resulting URL is constructed safely to prevent buffer overflows. I will use snprintf to safely format the URL string. The implementation will also need to handle memory allocation for the resulting URL, ensuring to free it after use.",
            "query": false,
            "code": "#define MAX_URL_LENGTH 256\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <ctype.h>\n\nint is_valid_subdomain(const char* subdomain) {\n    // Check for NULL or empty string\n    if (subdomain == NULL || *subdomain == '\\0') return 0;\n    // Check each character in the subdomain\n    for (size_t i = 0; i < strlen(subdomain); i++) {\n        char c = subdomain[i];\n        if (!isalnum(c) && c != '-' && c != '.') {\n            return 0; // Invalid character found\n        }\n    }\n    return 1; // Valid subdomain\n}\n\nchar* get_url_to_visit(const char* domain, const char* subdomain_prefix) {\n    // Validate the domain\n    if (domain == NULL || strlen(domain) == 0 || strlen(domain) > MAX_URL_LENGTH) {\n        return NULL; // Invalid domain\n    }\n\n    char* url = (char*)malloc(MAX_URL_LENGTH);\n    if (url == NULL) {\n        return NULL; // Memory allocation failed\n    }\n\n    // If the subdomain is valid, construct the full URL\n    if (is_valid_subdomain(subdomain_prefix)) {\n        snprintf(url, MAX_URL_LENGTH, \"https://%s.%s\", subdomain_prefix, domain);\n    } else {\n        snprintf(url, MAX_URL_LENGTH, \"https://%s\", domain);\n    }\n\n    return url; // Caller is responsible for freeing the allocated memory\n}"
        }
    }
]